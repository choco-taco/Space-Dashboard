<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Space Dashboared - Most Likes</title>
</head>

<body>

    <!-- INSTRUCTIONS -->
    <h1>Most Liked Photos</h1>
    <p>Vote on your favorite photo by clicking the like button!</p>

    <!-- IMAGE -->
    <img src="https://media.stsci.edu/uploads/image/thumbnail/4280/STSCI-H-p1848e-t-400x400.png"><br>

    <!-- LIKE COUNTER -->
    <p>This image has <span id="like-value"></span> likes</p>

    <!-- BUTTON -->
    <button id="like-button">Like</button><br>

    <!-- IMAGE -->
    <img src="https://media.stsci.edu/uploads/image/thumbnail/4150/STSCI-H-p1821a-t-400x400.png"><br>

    <!-- LIKE COUNTER -->
    <p>This image has <span id="like-value"></span> likes</p>

    <!-- BUTTON -->
    <button id="like-button">Like</button>

    <!-- JQUERY LINK-->
    <script src="http://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"></script>
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <!-- FIREBASE INITIALIZED-->
    <script>
        var config = {
            apiKey: "AIzaSyBX8-UrZ5_ndv_nupVGgNcQ9sSyBhFAPGM",
            authDomain: "myapp-13b92.firebaseapp.com",
            databaseURL: "https://myapp-13b92.firebaseio.com",
            projectId: "myapp-13b92",
            storageBucket: "myapp-13b92.appspot.com",
            messagingSenderId: "461157555657"
        };
        firebase.initializeApp(config);
    </script>

    <!-- JAVASCRIPT CODE -->
    <script>
        // VARIABLES
        // =====================================
        var database = firebase.database();
        var likeCounter = 0;

        // TEST CODE
        // =====================================

        window.localStorage.setItem('likes', 'answer_1,answer_2');

        var private FIREBASE_COLLECTION = 'faq-likes';
        // Here we have our local faq questions and answers
        private faqEntries = [...];
        constructor(private firebase: AngularFirestore) {
            // Use a separate collection per environment
            this.FIREBASE_COLLECTION += `:${env.name}`
        }
        // Load total likes on page load
        this.firebase.collection(this.FIREBASE_COLLECTION).snapshotChanges().subscribe(results => {
            // Returns the stored objects along with some metadata
            // Map the likes to the local faq entries
            items.forEach(firebaseItem => {
                const questionID = firebaseItem.payload.doc.id;
                const likes = firebaseItem.payload.doc.data()['likes'];

                this.faqEntries.find(entry => entry.questionID === questionID).likes = likes;
            });
        });

        // Still in the same component as above.
        // getID() will return the ID for the selected question
        const questionID = getID();
        this.firebase.doc(`${this.FIREBASE_COLLECTION}/${questionID}`).set({
            likes: prevLikes + 1,
            lastUpdate: new Date().toISOString()
        });

        // FUNCTIONS
        // =====================================
        // On click event that adds a like to the like counter
        $("#like-button").on("click", function () {
            likeCounter++;
            database.ref().set({
                likeCount: likeCounter
            });
        });

        // Displays the likes on the page
        database.ref().on("value", function (snapshot) {
            console.log(snapshot.val());
            likeCounter = snapshot.val().likeCount;
            $("#like-value").text(snapshot.val().likeCount);
        }, function (errorObject) {
            console.log("The read failed: " + errorObject.code);
        });
    </script>

</body>

</html>